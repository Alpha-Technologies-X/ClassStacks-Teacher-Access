<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Class Stacks - Teacher Dashboard</title>
    <style>
        :root {
            --primary: #4361ee;
            --secondary: #3f37c9;
            --danger: #e63946;
            --success: #2a9d8f;
            --warning: #f4a261;
            --dark: #212529;
            --light: #f8f9fa;
            --sidebar: #2c3e50;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: #f5f7fb;
            color: var(--dark);
        }
        
        .auth-container {
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px;
        }
        
        .auth-box {
            background: white;
            padding: 40px;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            width: 100%;
            max-width: 450px;
        }
        
        .logo {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .logo h1 {
            color: var(--primary);
            font-size: 2.5rem;
            margin-bottom: 10px;
        }
        
        .tabs {
            display: flex;
            margin-bottom: 30px;
            background: #f8f9fa;
            border-radius: 10px;
            padding: 5px;
        }
        
        .tab {
            flex: 1;
            padding: 12px;
            text-align: center;
            background: none;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
        }
        
        .tab.active {
            background: var(--primary);
            color: white;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            color: #555;
            font-weight: 500;
        }
        
        input, select {
            width: 100%;
            padding: 15px;
            border: 2px solid #e1e5ee;
            border-radius: 10px;
            font-size: 16px;
            transition: all 0.3s;
        }
        
        input:focus, select:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(67, 97, 238, 0.1);
        }
        
        .btn {
            padding: 12px 20px;
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .btn:hover {
            background: var(--secondary);
            transform: translateY(-2px);
        }
        
        .btn-danger {
            background: var(--danger);
        }
        
        .btn-success {
            background: var(--success);
        }
        
        .btn-warning {
            background: var(--warning);
        }
        
        .btn-small {
            padding: 8px 15px;
            font-size: 14px;
        }
        
        .error-message {
            color: var(--danger);
            text-align: center;
            margin-top: 15px;
            padding: 12px;
            background: #ffeaea;
            border-radius: 8px;
            display: none;
        }
        
        .dashboard {
            display: none;
            min-height: 100vh;
        }
        
        .sidebar {
            width: 280px;
            background: var(--sidebar);
            color: white;
            position: fixed;
            height: 100vh;
            overflow-y: auto;
        }
        
        .sidebar-header {
            padding: 30px 20px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .sidebar-nav {
            padding: 20px 0;
        }
        
        .nav-item {
            padding: 15px 25px;
            display: flex;
            align-items: center;
            gap: 15px;
            cursor: pointer;
            transition: all 0.3s;
            border-left: 4px solid transparent;
        }
        
        .nav-item:hover, .nav-item.active {
            background: rgba(255, 255, 255, 0.1);
            border-left-color: var(--primary);
        }
        
        .main-content {
            margin-left: 280px;
            padding: 0;
            width: calc(100% - 280px);
        }
        
        .header {
            background: white;
            padding: 20px 30px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .user-menu {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .content-area {
            padding: 30px;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
            border-left: 5px solid var(--primary);
        }
        
        .stat-card.warning {
            border-left-color: var(--warning);
        }
        
        .stat-card.danger {
            border-left-color: var(--danger);
        }
        
        .stat-card.success {
            border-left-color: var(--success);
        }
        
        .stat-value {
            font-size: 2.5rem;
            font-weight: bold;
            color: var(--primary);
        }
        
        .stat-label {
            color: #666;
            font-size: 0.9rem;
        }
        
        .section-title {
            margin: 30px 0 20px;
            color: var(--dark);
            font-size: 1.3rem;
        }
        
        .student-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
            gap: 20px;
        }
        
        .student-card {
            background: white;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
            transition: transform 0.3s;
        }
        
        .student-card:hover {
            transform: translateY(-5px);
        }
        
        .student-header {
            display: flex;
            align-items: center;
            padding: 20px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
        }
        
        .student-avatar {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            font-weight: bold;
            margin-right: 15px;
        }
        
        .student-status {
            margin-left: auto;
            background: white;
            color: var(--primary);
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: bold;
        }
        
        .status-online {
            background: var(--success);
            color: white;
        }
        
        .status-offline {
            background: #6c757d;
            color: white;
        }
        
        .status-restricted {
            background: var(--danger);
            color: white;
        }
        
        .student-details {
            padding: 20px;
        }
        
        .detail-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 12px;
            padding-bottom: 12px;
            border-bottom: 1px solid #f0f0f0;
        }
        
        .detail-label {
            color: #666;
        }
        
        .student-actions {
            display: flex;
            padding: 15px 20px;
            background: #f8f9fa;
            border-top: 1px solid #e9ecef;
            gap: 10px;
        }
        
        .action-btn {
            flex: 1;
            padding: 10px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.8rem;
        }
        
        .controls-panel {
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
            margin-bottom: 30px;
        }
        
        .control-group {
            margin-bottom: 25px;
        }
        
        .control-group h3 {
            margin-bottom: 15px;
            color: var(--dark);
        }
        
        .blocked-list {
            max-height: 200px;
            overflow-y: auto;
            border: 1px solid #e1e5ee;
            border-radius: 8px;
            padding: 15px;
            background: white;
        }
        
        .blocked-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            background: #ffeaea;
            margin-bottom: 8px;
            border-radius: 6px;
        }
        
        .activity-log {
            max-height: 400px;
            overflow-y: auto;
            border: 1px solid #e1e5ee;
            border-radius: 8px;
            background: white;
        }
        
        .log-item {
            padding: 15px 20px;
            border-bottom: 1px solid #f0f0f0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .log-item:last-child {
            border-bottom: none;
        }
        
        .log-time {
            color: #666;
            font-size: 0.8rem;
        }
        
        .class-code-display {
            background: #e7f3ff;
            padding: 15px;
            border-radius: 8px;
            margin-top: 10px;
            display: none;
        }
        
        .sync-status {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: var(--success);
            color: white;
            padding: 10px 15px;
            border-radius: 20px;
            font-size: 0.8rem;
            display: none;
        }
        
        @media (max-width: 768px) {
            .sidebar {
                width: 100%;
                height: auto;
                position: relative;
            }
            
            .main-content {
                margin-left: 0;
                width: 100%;
            }
            
            .student-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <!-- Authentication -->
    <div class="auth-container" id="authContainer">
        <div class="auth-box">
            <div class="logo">
                <h1>üè´ Class Stacks</h1>
                <p>Teacher Dashboard</p>
            </div>
            
            <div class="tabs">
                <button class="tab active" onclick="switchTab('login')">Login</button>
                <button class="tab" onclick="switchTab('signup')">Sign Up</button>
            </div>
            
            <form id="authForm">
                <div class="form-group">
                    <label for="fullName">Full Name</label>
                    <input type="text" id="fullName" placeholder="Enter your full name" style="display: none;">
                </div>
                
                <div class="form-group">
                    <label for="email">Email</label>
                    <input type="email" id="email" placeholder="Enter your email" required>
                </div>
                
                <div class="form-group">
                    <label for="password">Password</label>
                    <input type="password" id="password" placeholder="Enter your password" required>
                </div>
                
                <div class="form-group" id="classCodeGroup" style="display: none;">
                    <label for="classCode">Class Code</label>
                    <input type="text" id="classCode" placeholder="Enter class code">
                </div>
                
                <button type="submit" class="btn" style="width: 100%;" id="authButton">Login</button>
            </form>
            
            <div class="error-message" id="errorMessage"></div>
            
            <div style="margin-top: 25px; padding: 20px; background: #f8f9fa; border-radius: 10px; font-size: 14px;">
                <strong>Demo Access:</strong><br>
                Teacher: email: <code>teacher@classstacks.com</code><br>
                Password: <code>teach123</code>
            </div>
        </div>
    </div>

    <!-- Dashboard -->
    <div class="dashboard" id="dashboard">
        <div class="sidebar">
            <div class="sidebar-header">
                <h2>Class Stacks</h2>
                <p>Teacher Dashboard</p>
            </div>
            
            <div class="sidebar-nav">
                <div class="nav-item active" onclick="showSection('overview')">
                    üìä Dashboard Overview
                </div>
                <div class="nav-item" onclick="showSection('students')">
                    üë• Student Management
                </div>
                <div class="nav-item" onclick="showSection('controls')">
                    ‚öôÔ∏è Classroom Controls
                </div>
                <div class="nav-item" onclick="showSection('reports')">
                    üìà Reports & Analytics
                </div>
            </div>
        </div>
        
        <div class="main-content">
            <div class="header">
                <h2 id="sectionTitle">Dashboard Overview</h2>
                <div class="user-menu">
                    <span id="userWelcome">Welcome, Teacher</span>
                    <button class="btn btn-danger" onclick="logout()">Logout</button>
                </div>
            </div>
            
            <div class="content-area">
                <!-- Overview Section -->
                <div id="overviewSection">
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-value" id="totalStudents">0</div>
                            <div class="stat-label">Total Students</div>
                        </div>
                        <div class="stat-card success">
                            <div class="stat-value" id="activeStudents">0</div>
                            <div class="stat-label">Active Now</div>
                        </div>
                        <div class="stat-card warning">
                            <div class="stat-value" id="blockedSites">0</div>
                            <div class="stat-label">Blocked Sites</div>
                        </div>
                        <div class="stat-card danger">
                            <div class="stat-value" id="alertsToday">0</div>
                            <div class="stat-label">Alerts Today</div>
                        </div>
                    </div>
                    
                    <h3 class="section-title">Recent Activity</h3>
                    <div class="activity-log" id="recentActivity">
                        <div class="log-item">
                            <div>System: Dashboard initialized</div>
                            <div class="log-time" id="currentTime"></div>
                        </div>
                    </div>
                </div>
                
                <!-- Students Section -->
                <div id="studentsSection" style="display: none;">
                    <h3 class="section-title">Student Management</h3>
                    <div class="student-grid" id="studentGrid">
                        <!-- Student cards will be populated here -->
                    </div>
                </div>
                
                <!-- Controls Section -->
                <div id="controlsSection" style="display: none;">
                    <h3 class="section-title">Classroom Controls</h3>
                    
                    <div class="controls-panel">
                        <div class="control-group">
                            <h3>Website Filtering</h3>
                            <div style="display: flex; gap: 10px; margin-top: 15px;">
                                <input type="text" id="blockUrlInput" placeholder="Enter website to block (e.g., youtube.com)" style="flex: 1;">
                                <button class="btn btn-danger" onclick="blockWebsite()">Block Site</button>
                            </div>
                            <div style="margin-top: 10px; font-size: 0.9rem; color: #666;">
                                <strong>Currently Blocked:</strong> YouTube, Facebook, TikTok, Instagram, Netflix
                            </div>
                        </div>
                        
                        <div class="control-group">
                            <h3>Blocked Websites</h3>
                            <div id="blockedList" class="blocked-list">
                                <!-- Blocked sites will appear here -->
                            </div>
                        </div>
                        
                        <div class="control-group">
                            <h3>Class Settings</h3>
                            <button class="btn" onclick="createClassCode()">Generate Class Code</button>
                            <div id="classCodeDisplay" class="class-code-display">
                                <!-- Class code will appear here -->
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Reports Section -->
                <div id="reportsSection" style="display: none;">
                    <h3 class="section-title">Reports & Analytics</h3>
                    <div class="controls-panel">
                        <h3>Student Activity Report</h3>
                        <p>Monitor student browsing patterns and productivity metrics.</p>
                        <button class="btn" onclick="generateReport()">Generate Weekly Report</button>
                        <div id="reportOutput" style="margin-top: 20px;"></div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="sync-status" id="syncStatus">üîÑ Syncing...</div>
    </div>

    <script>
        // Teacher authentication and data management
        const teacherAccounts = JSON.parse(localStorage.getItem('teacherAccounts') || '{}');
        let currentTeacher = null;
        let syncInterval = null;
        
        // Initialize default teacher account
        if (!teacherAccounts['teacher@classstacks.com']) {
            teacherAccounts['teacher@classstacks.com'] = {
                email: 'teacher@classstacks.com',
                password: 'teach123',
                name: 'Demo Teacher',
                classCode: 'CS2024'
            };
            localStorage.setItem('teacherAccounts', JSON.stringify(teacherAccounts));
        }
        
        // Initialize blocked sites with popular sites that block iframes
        if (!localStorage.getItem('blockedSites')) {
            localStorage.setItem('blockedSites', JSON.stringify([
                'youtube.com',
                'facebook.com', 
                'tiktok.com',
                'instagram.com',
                'netflix.com',
                'twitter.com',
                'reddit.com',
                'discord.com'
            ]));
        }
        
        // Initialize restricted students
        if (!localStorage.getItem('restrictedStudents')) {
            localStorage.setItem('restrictedStudents', JSON.stringify({}));
        }
        
        // Initialize activity log
        if (!localStorage.getItem('activityLog')) {
            localStorage.setItem('activityLog', JSON.stringify([{
                actor: 'System',
                action: 'Class Stacks initialized',
                timestamp: Date.now()
            }]));
        }
        
        // Tab switching
        function switchTab(tab) {
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            event.target.classList.add('active');
            
            const fullName = document.getElementById('fullName');
            const authButton = document.getElementById('authButton');
            const classCodeGroup = document.getElementById('classCodeGroup');
            
            if (tab === 'signup') {
                fullName.style.display = 'block';
                authButton.textContent = 'Sign Up';
                classCodeGroup.style.display = 'block';
            } else {
                fullName.style.display = 'none';
                authButton.textContent = 'Login';
                classCodeGroup.style.display = 'none';
            }
        }
        
        // Authentication
        document.getElementById('authForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            const fullName = document.getElementById('fullName').value;
            const classCode = document.getElementById('classCode').value;
            const isSignup = document.getElementById('authButton').textContent === 'Sign Up';
            
            if (isSignup) {
                // Teacher signup
                if (teacherAccounts[email]) {
                    showError('Email already registered');
                    return;
                }
                
                teacherAccounts[email] = {
                    email: email,
                    password: password,
                    name: fullName,
                    classCode: classCode || 'CLASS' + Math.random().toString(36).substr(2, 6).toUpperCase()
                };
                localStorage.setItem('teacherAccounts', JSON.stringify(teacherAccounts));
                currentTeacher = teacherAccounts[email];
                showDashboard();
            } else {
                // Teacher login
                if (teacherAccounts[email] && teacherAccounts[email].password === password) {
                    currentTeacher = teacherAccounts[email];
                    showDashboard();
                } else {
                    showError('Invalid email or password');
                }
            }
        });
        
        function showError(message) {
            const errorElement = document.getElementById('errorMessage');
            errorElement.textContent = message;
            errorElement.style.display = 'block';
            setTimeout(() => errorElement.style.display = 'none', 3000);
        }
        
        function showDashboard() {
            document.getElementById('authContainer').style.display = 'none';
            document.getElementById('dashboard').style.display = 'flex';
            document.getElementById('userWelcome').textContent = `Welcome, ${currentTeacher.name}`;
            initializeDashboard();
            startSyncMonitoring();
        }
        
        function showSection(section) {
            document.querySelectorAll('.nav-item').forEach(item => item.classList.remove('active'));
            event.target.classList.add('active');
            
            document.getElementById('overviewSection').style.display = 'none';
            document.getElementById('studentsSection').style.display = 'none';
            document.getElementById('controlsSection').style.display = 'none';
            document.getElementById('reportsSection').style.display = 'none';
            
            document.getElementById(section + 'Section').style.display = 'block';
            document.getElementById('sectionTitle').textContent = 
                section.charAt(0).toUpperCase() + section.slice(1) + 
                (section === 'overview' ? ' Overview' : 
                 section === 'students' ? ' Management' : 
                 section === 'controls' ? ' Controls' : ' & Analytics');
            
            // Refresh data when switching sections
            if (section === 'students') updateStudentMonitoring();
            if (section === 'controls') updateBlockedList();
            if (section === 'overview') updateActivityLog();
        }
        
        function initializeDashboard() {
            updateStudentMonitoring();
            updateBlockedList();
            updateActivityLog();
            updateDashboardStats();
            
            // Update current time
            document.getElementById('currentTime').textContent = new Date().toLocaleTimeString();
        }
        
        function updateStudentMonitoring() {
            const students = getActiveStudents();
            const studentGrid = document.getElementById('studentGrid');
            studentGrid.innerHTML = '';
            
            students.forEach(student => {
                const restrictedStudents = JSON.parse(localStorage.getItem('restrictedStudents') || '{}');
                const isRestricted = restrictedStudents[student.id];
                const isActive = student.lastActive > (Date.now() - 300000); // 5 minutes
                
                const card = document.createElement('div');
                card.className = 'student-card';
                card.innerHTML = `
                    <div class="student-header">
                        <div class="student-avatar">${student.name.charAt(0)}</div>
                        <div>
                            <h4>${student.name}</h4>
                            <p>ID: ${student.id}</p>
                            ${isRestricted ? '<p style="color: var(--danger); font-size: 0.8rem;">üîí Restricted Mode</p>' : ''}
                        </div>
                        <div class="student-status ${isActive ? (isRestricted ? 'status-restricted' : 'status-online') : 'status-offline'}">
                            ${isActive ? (isRestricted ? 'RESTRICTED' : 'ONLINE') : 'OFFLINE'}
                        </div>
                    </div>
                    <div class="student-details">
                        <div class="detail-row">
                            <span class="detail-label">Current Activity:</span>
                            <span>${student.currentUrl || 'No activity'}</span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">Last Active:</span>
                            <span>${formatTime(student.lastActive)}</span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">Status:</span>
                            <span>${isActive ? 'Active' : 'Inactive'}</span>
                        </div>
                    </div>
                    <div class="student-actions">
                        <button class="action-btn btn" onclick="sendMessage('${student.id}')">Message</button>
                        <button class="action-btn ${isRestricted ? 'btn-success' : 'btn-warning'}" onclick="toggleRestriction('${student.id}')">
                            ${isRestricted ? 'Unrestrict' : 'Restrict'}
                        </button>
                        <button class="action-btn btn-danger" onclick="viewStudentDetails('${student.id}')">Details</button>
                    </div>
                `;
                studentGrid.appendChild(card);
            });
        }
        
        function getActiveStudents() {
            const students = [];
            
            // Check all localStorage keys for student data
            for (let i = 0; i < localStorage.length; i++) {
                const key = localStorage.key(i);
                if (key.startsWith('student_')) {
                    try {
                        const studentData = JSON.parse(localStorage.getItem(key));
                        students.push(studentData);
                    } catch (e) {
                        console.log('Error parsing student data:', key);
                    }
                }
            }
            
            return students;
        }
        
        function updateBlockedList() {
            const blockedList = document.getElementById('blockedList');
            const blockedSites = JSON.parse(localStorage.getItem('blockedSites') || '[]');
            
            blockedList.innerHTML = '';
            blockedSites.forEach(site => {
                const item = document.createElement('div');
                item.className = 'blocked-item';
                item.innerHTML = `
                    <span>${site}</span>
                    <button class="btn btn-success btn-small" onclick="unblockWebsite('${site}')">Unblock</button>
                `;
                blockedList.appendChild(item);
            });
        }
        
        function updateDashboardStats() {
            const students = getActiveStudents();
            const activeStudents = students.filter(s => s.lastActive > (Date.now() - 300000)).length;
            const blockedSites = JSON.parse(localStorage.getItem('blockedSites') || '[]').length;
            const restrictedStudents = Object.keys(JSON.parse(localStorage.getItem('restrictedStudents') || '{}')).length;
            
            document.getElementById('totalStudents').textContent = students.length;
            document.getElementById('activeStudents').textContent = activeStudents;
            document.getElementById('blockedSites').textContent = blockedSites;
            document.getElementById('alertsToday').textContent = restrictedStudents;
        }
        
        function updateActivityLog() {
            const logElement = document.getElementById('recentActivity');
            const activities = JSON.parse(localStorage.getItem('activityLog') || '[]');
            
            logElement.innerHTML = '';
            activities.slice(-10).reverse().forEach(activity => {
                const item = document.createElement('div');
                item.className = 'log-item';
                item.innerHTML = `
                    <div><strong>${activity.actor}</strong>: ${activity.action}</div>
                    <div class="log-time">${formatTime(activity.timestamp)}</div>
                `;
                logElement.appendChild(item);
            });
        }
        
        function blockWebsite() {
            const urlInput = document.getElementById('blockUrlInput');
            const url = urlInput.value.trim().toLowerCase();
            
            if (url) {
                const blockedSites = JSON.parse(localStorage.getItem('blockedSites') || '[]');
                if (!blockedSites.includes(url)) {
                    blockedSites.push(url);
                    localStorage.setItem('blockedSites', JSON.stringify(blockedSites));
                    urlInput.value = '';
                    updateBlockedList();
                    updateDashboardStats();
                    addToActivityLog('Teacher', `Blocked website: ${url}`);
                    showSyncStatus('Website blocked successfully');
                    
                    // Force update all student browsers
                    localStorage.setItem('forceStudentUpdate', Date.now().toString());
                } else {
                    showSyncStatus('Website already blocked', 'warning');
                }
            }
        }
        
        function unblockWebsite(site) {
            const blockedSites = JSON.parse(localStorage.getItem('blockedSites') || '[]');
            const updatedSites = blockedSites.filter(s => s !== site);
            localStorage.setItem('blockedSites', JSON.stringify(updatedSites));
            updateBlockedList();
            updateDashboardStats();
            addToActivityLog('Teacher', `Unblocked website: ${site}`);
            showSyncStatus('Website unblocked successfully');
            
            // Force update all student browsers
            localStorage.setItem('forceStudentUpdate', Date.now().toString());
        }
        
        function toggleRestriction(studentId) {
            const restrictedStudents = JSON.parse(localStorage.getItem('restrictedStudents') || '{}');
            
            if (restrictedStudents[studentId]) {
                // Unrestrict student
                delete restrictedStudents[studentId];
                localStorage.setItem('restrictedStudents', JSON.stringify(restrictedStudents));
                addToActivityLog('Teacher', `Removed restrictions from student ${studentId}`);
                showSyncStatus('Student restrictions removed');
            } else {
                // Restrict student
                restrictedStudents[studentId] = true;
                localStorage.setItem('restrictedStudents', JSON.stringify(restrictedStudents));
                addToActivityLog('Teacher', `Applied restrictions to student ${studentId}`);
                showSyncStatus('Student restrictions applied');
            }
            
            updateStudentMonitoring();
            updateDashboardStats();
            
            // Force update student browser
            localStorage.setItem('forceStudentUpdate', Date.now().toString());
        }
        
        function createClassCode() {
            const code = 'CLASS' + Math.random().toString(36).substr(2, 6).toUpperCase();
            const display = document.getElementById('classCodeDisplay');
            display.style.display = 'block';
            display.innerHTML = `
                <strong>Class Code:</strong> ${code}<br>
                <small>Share this code with students to join your class. Students will use this code when they sign in.</small>
            `;
            addToActivityLog('Teacher', `Generated new class code: ${code}`);
            showSyncStatus('Class code generated');
        }
        
        function sendMessage(studentId) {
            const message = prompt('Enter message to send to student:');
            if (message) {
                addToActivityLog('Teacher', `Sent message to ${studentId}: "${message}"`);
                showSyncStatus('Message sent to student');
            }
        }
        
        function viewStudentDetails(studentId) {
            const studentData = JSON.parse(localStorage.getItem(studentId) || '{}');
            alert(`Student Details:\nName: ${studentData.name}\nID: ${studentData.id}\nCurrent URL: ${studentData.currentUrl || 'None'}\nLast Active: ${formatTime(studentData.lastActive)}\nRestricted: ${JSON.parse(localStorage.getItem('restrictedStudents') || '{}')[studentId] ? 'Yes' : 'No'}`);
        }
        
        function generateReport() {
            const students = getActiveStudents();
            const activeCount = students.filter(s => s.lastActive > (Date.now() - 300000)).length;
            const blockedCount = JSON.parse(localStorage.getItem('blockedSites') || '[]').length;
            const restrictedCount = Object.keys(JSON.parse(localStorage.getItem('restrictedStudents') || '{}')).length;
            
            const reportOutput = document.getElementById('reportOutput');
            reportOutput.innerHTML = `
                <div style="background: #f8f9fa; padding: 20px; border-radius: 10px;">
                    <h4>Weekly Classroom Report</h4>
                    <p><strong>Total Students:</strong> ${students.length}</p>
                    <p><strong>Average Active Students:</strong> ${activeCount}</p>
                    <p><strong>Blocked Websites:</strong> ${blockedCount}</p>
                    <p><strong>Restricted Students:</strong> ${restrictedCount}</p>
                    <p><strong>Report Generated:</strong> ${new Date().toLocaleString()}</p>
                </div>
            `;
            addToActivityLog('Teacher', 'Generated weekly report');
            showSyncStatus('Report generated successfully');
        }
        
        function addToActivityLog(actor, action) {
            const activities = JSON.parse(localStorage.getItem('activityLog') || '[]');
            activities.push({
                actor: actor,
                action: action,
                timestamp: Date.now()
            });
            
            // Keep only last 50 activities
            if (activities.length > 50) {
                activities.splice(0, activities.length - 50);
            }
            
            localStorage.setItem('activityLog', JSON.stringify(activities));
            updateActivityLog();
        }
        
        function formatTime(timestamp) {
            return new Date(timestamp).toLocaleTimeString();
        }
        
        function showSyncStatus(message, type = 'success') {
            const syncStatus = document.getElementById('syncStatus');
            syncStatus.textContent = '‚úÖ ' + message;
            syncStatus.style.background = type === 'success' ? 'var(--success)' : 'var(--warning)';
            syncStatus.style.display = 'block';
            
            setTimeout(() => {
                syncStatus.style.display = 'none';
            }, 3000);
        }
        
        // Cross-device synchronization
        function startSyncMonitoring() {
            // Check for updates every 2 seconds
            syncInterval = setInterval(() => {
                updateStudentMonitoring();
                updateDashboardStats();
                document.getElementById('currentTime').textContent = new Date().toLocaleTimeString();
            }, 2000);
            
            // Listen for storage changes (cross-tab/device communication)
            window.addEventListener('storage', function(e) {
                showSyncStatus('Data updated from another device');
                initializeDashboard();
            });
        }
        
        function logout() {
            if (syncInterval) {
                clearInterval(syncInterval);
            }
            
            currentTeacher = null;
            document.getElementById('dashboard').style.display = 'none';
            document.getElementById('authContainer').style.display = 'flex';
            document.getElementById('authForm').reset();
        }
        
        // Initialize auth tab
        switchTab('login');
        
        // Auto-update time every minute
        setInterval(() => {
            document.getElementById('currentTime').textContent = new Date().toLocaleTimeString();
        }, 60000);
    </script>
</body>
</html>
