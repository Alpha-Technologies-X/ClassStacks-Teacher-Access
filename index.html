<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Class Stacks - Teacher Dashboard</title>
    <style>
        :root {
            --primary: #4361ee;
            --secondary: #3f37c9;
            --danger: #e63946;
            --success: #2a9d8f;
            --warning: #f4a261;
            --dark: #212529;
            --light: #f8f9fa;
            --sidebar: #2c3e50;
            --sidebar-hover: #34495e;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: #f5f7fb;
            color: var(--dark);
        }
        
        /* Authentication Styles */
        .auth-container {
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            padding: 20px;
        }
        
        .auth-box {
            background: white;
            padding: 40px;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            width: 100%;
            max-width: 500px;
        }
        
        .auth-logo {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .auth-logo h1 {
            color: var(--primary);
            font-size: 2.5rem;
            margin-bottom: 10px;
        }
        
        .auth-tabs {
            display: flex;
            margin-bottom: 25px;
            border-bottom: 1px solid #e1e5ee;
        }
        
        .auth-tab {
            flex: 1;
            padding: 12px;
            text-align: center;
            cursor: pointer;
            font-weight: 600;
            color: #666;
            border-bottom: 3px solid transparent;
            transition: all 0.3s;
        }
        
        .auth-tab.active {
            color: var(--primary);
            border-bottom-color: var(--primary);
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: #555;
            font-weight: 500;
        }
        
        .form-group input, .form-group select, .form-group textarea {
            width: 100%;
            padding: 14px;
            border: 2px solid #e1e5ee;
            border-radius: 8px;
            font-size: 16px;
            transition: all 0.3s;
        }
        
        .form-group input:focus, .form-group select:focus, .form-group textarea:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(67, 97, 238, 0.1);
        }
        
        .btn {
            padding: 14px 20px;
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .btn:hover {
            background: var(--secondary);
        }
        
        .btn-success {
            background: var(--success);
        }
        
        .btn-success:hover {
            background: #219653;
        }
        
        .btn-danger {
            background: var(--danger);
        }
        
        .btn-danger:hover {
            background: #c0392b;
        }
        
        .btn-warning {
            background: var(--warning);
        }
        
        .btn-warning:hover {
            background: #e67e22;
        }
        
        .auth-toggle {
            text-align: center;
            margin-top: 20px;
            font-size: 0.9rem;
        }
        
        .auth-toggle a {
            color: var(--primary);
            text-decoration: none;
            font-weight: 600;
        }
        
        .auth-toggle a:hover {
            text-decoration: underline;
        }
        
        .error-message {
            color: var(--danger);
            text-align: center;
            margin-top: 15px;
            padding: 12px;
            background: #ffeaea;
            border-radius: 8px;
            display: none;
        }
        
        .success-message {
            color: var(--success);
            text-align: center;
            margin-top: 15px;
            padding: 12px;
            background: #e8f5e8;
            border-radius: 8px;
            display: none;
        }
        
        /* Dashboard Layout */
        .dashboard {
            display: none;
        }
        
        .dashboard-header {
            background: white;
            padding: 0 25px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
            height: 70px;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 100;
        }
        
        .header-left {
            display: flex;
            align-items: center;
            gap: 20px;
        }
        
        .logo {
            font-size: 1.8rem;
            font-weight: bold;
            color: var(--primary);
        }
        
        .header-right {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .user-info {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: var(--primary);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }
        
        .sidebar {
            background: var(--sidebar);
            color: white;
            width: 250px;
            height: calc(100vh - 70px);
            position: fixed;
            top: 70px;
            left: 0;
            overflow-y: auto;
            padding: 20px 0;
        }
        
        .sidebar-menu {
            list-style: none;
        }
        
        .sidebar-item {
            padding: 15px 25px;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .sidebar-item:hover {
            background: var(--sidebar-hover);
        }
        
        .sidebar-item.active {
            background: var(--primary);
        }
        
        .main-content {
            margin-left: 250px;
            margin-top: 70px;
            padding: 30px;
            min-height: calc(100vh - 70px);
        }
        
        .content-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
        }
        
        .content-title {
            font-size: 1.8rem;
            font-weight: 600;
            color: var(--dark);
        }
        
        /* Stats Grid */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: white;
            padding: 25px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
            text-align: center;
            border-left: 4px solid var(--primary);
        }
        
        .stat-value {
            font-size: 2.5rem;
            font-weight: bold;
            color: var(--primary);
            margin-bottom: 10px;
        }
        
        .stat-label {
            color: #666;
            font-size: 0.95rem;
        }
        
        /* Content Cards */
        .content-card {
            background: white;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
            margin-bottom: 25px;
            overflow: hidden;
        }
        
        .card-header {
            padding: 20px 25px;
            border-bottom: 1px solid #e1e5ee;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .card-title {
            font-size: 1.3rem;
            font-weight: 600;
            color: var(--dark);
        }
        
        .card-body {
            padding: 25px;
        }
        
        /* Student Monitoring */
        .student-monitoring {
            display: grid;
            grid-template-columns: 1fr 400px;
            gap: 25px;
        }
        
        .student-list-container {
            background: white;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
            overflow: hidden;
        }
        
        .student-list-header {
            padding: 20px;
            border-bottom: 1px solid #e1e5ee;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .student-list {
            max-height: 600px;
            overflow-y: auto;
        }
        
        .student-card {
            padding: 20px;
            border-bottom: 1px solid #e1e5ee;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .student-card:hover {
            background: #f8f9fa;
        }
        
        .student-card.active {
            background: #e7f0ff;
            border-left: 4px solid var(--primary);
        }
        
        .student-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .student-name {
            font-weight: 600;
            font-size: 1.1rem;
        }
        
        .student-status {
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: bold;
        }
        
        .status-online {
            background: #e7f7e9;
            color: var(--success);
        }
        
        .status-offline {
            background: #f0f0f0;
            color: #666;
        }
        
        .status-bypass {
            background: #fff3cd;
            color: var(--warning);
        }
        
        .student-info {
            font-size: 0.9rem;
            color: #666;
            margin-bottom: 10px;
        }
        
        .student-tabs-preview {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 10px;
        }
        
        .tab-preview {
            background: #f8f9fa;
            padding: 5px 10px;
            border-radius: 5px;
            font-size: 0.8rem;
            color: #555;
            border: 1px solid #e1e5ee;
            max-width: 120px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }
        
        .tab-preview.active {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }
        
        /* Student Detail Panel */
        .student-detail-panel {
            background: white;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }
        
        .student-detail-header {
            padding: 20px;
            border-bottom: 1px solid #e1e5ee;
        }
        
        .student-controls {
            display: flex;
            gap: 10px;
            margin-top: 15px;
            flex-wrap: wrap;
        }
        
        .control-btn {
            padding: 8px 15px;
            border-radius: 6px;
            font-weight: 600;
            cursor: pointer;
            border: none;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.9rem;
        }
        
        .control-btn.primary {
            background: var(--primary);
            color: white;
        }
        
        .control-btn.danger {
            background: var(--danger);
            color: white;
        }
        
        .control-btn.warning {
            background: var(--warning);
            color: white;
        }
        
        .control-btn.success {
            background: var(--success);
            color: white;
        }
        
        .student-tabs-container {
            padding: 20px;
            border-bottom: 1px solid #e1e5ee;
        }
        
        .tabs-list {
            display: flex;
            flex-direction: column;
            gap: 10px;
            max-height: 200px;
            overflow-y: auto;
        }
        
        .tab-item {
            display: flex;
            align-items: center;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 8px;
            border: 1px solid #e1e5ee;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .tab-item:hover {
            background: #e9ecef;
        }
        
        .tab-item.active {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }
        
        .tab-favicon {
            margin-right: 10px;
            font-size: 1rem;
        }
        
        .tab-details {
            flex: 1;
            min-width: 0;
        }
        
        .tab-title {
            font-weight: 500;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .tab-url {
            font-size: 0.8rem;
            color: #666;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .tab-item.active .tab-url {
            color: rgba(255, 255, 255, 0.8);
        }
        
        .tab-close {
            margin-left: 10px;
            opacity: 0.7;
            cursor: pointer;
            padding: 5px;
            border-radius: 3px;
        }
        
        .tab-close:hover {
            opacity: 1;
            background: rgba(0, 0, 0, 0.1);
        }
        
        .tab-item.active .tab-close:hover {
            background: rgba(255, 255, 255, 0.2);
        }
        
        /* Screen View */
        .screen-view {
            flex: 1;
            padding: 20px;
            display: flex;
            flex-direction: column;
        }
        
        .screen-container {
            background: #1a1a1a;
            border-radius: 10px;
            overflow: hidden;
            position: relative;
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 300px;
        }
        
        .screen-canvas {
            max-width: 100%;
            max-height: 100%;
            border-radius: 5px;
        }
        
        .screen-placeholder {
            text-align: center;
            color: #aaa;
            padding: 40px;
        }
        
        .screen-placeholder-icon {
            font-size: 4rem;
            margin-bottom: 20px;
            opacity: 0.5;
        }
        
        /* Class Management */
        .class-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
        }
        
        .class-card {
            background: white;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
            padding: 25px;
            transition: all 0.3s;
            cursor: pointer;
            border: 1px solid #e1e5ee;
        }
        
        .class-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
        }
        
        .class-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .class-name {
            font-weight: 600;
            font-size: 1.2rem;
        }
        
        .class-code {
            font-family: monospace;
            background: #f8f9fa;
            padding: 5px 10px;
            border-radius: 5px;
            font-size: 0.9rem;
        }
        
        .class-info {
            font-size: 0.9rem;
            color: #666;
            margin-bottom: 20px;
        }
        
        .class-stats {
            display: flex;
            gap: 15px;
        }
        
        .class-stat {
            text-align: center;
            flex: 1;
        }
        
        .class-stat-value {
            font-size: 1.5rem;
            font-weight: bold;
            color: var(--primary);
        }
        
        .class-stat-label {
            font-size: 0.8rem;
            color: #666;
        }
        
        /* Bypass Management */
        .bypass-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
        }
        
        .bypass-card {
            background: white;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
            padding: 25px;
            border-left: 4px solid var(--warning);
        }
        
        .bypass-code {
            font-family: monospace;
            font-size: 1.3rem;
            font-weight: bold;
            margin-bottom: 10px;
            color: var(--dark);
        }
        
        .bypass-info {
            font-size: 0.9rem;
            color: #666;
            margin-bottom: 15px;
        }
        
        .bypass-status {
            display: inline-block;
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: bold;
        }
        
        .status-active {
            background: #e7f7e9;
            color: var(--success);
        }
        
        .status-expired {
            background: #ffeaea;
            color: var(--danger);
        }
        
        /* Schedule Management */
        .schedule-list {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        
        .schedule-item {
            background: white;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
            padding: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .schedule-details {
            flex: 1;
        }
        
        .schedule-time {
            font-weight: 600;
            font-size: 1.1rem;
            margin-bottom: 5px;
        }
        
        .schedule-class {
            color: #666;
            font-size: 0.9rem;
        }
        
        .schedule-status {
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: bold;
        }
        
        .status-upcoming {
            background: #e7f0ff;
            color: var(--primary);
        }
        
        .status-active {
            background: #e7f7e9;
            color: var(--success);
        }
        
        .status-ended {
            background: #f0f0f0;
            color: #666;
        }
        
        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        
        .modal-content {
            background: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.2);
            width: 90%;
            max-width: 500px;
            max-height: 90vh;
            overflow-y: auto;
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid #e1e5ee;
        }
        
        .modal-title {
            font-size: 1.4rem;
            font-weight: 600;
            color: var(--dark);
        }
        
        .modal-close {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: #666;
        }
        
        .modal-close:hover {
            color: var(--danger);
        }
        
        /* Blocking Management */
        .blocking-tabs {
            display: flex;
            border-bottom: 1px solid #e1e5ee;
            margin-bottom: 20px;
        }
        
        .blocking-tab {
            padding: 12px 20px;
            cursor: pointer;
            font-weight: 500;
            border-bottom: 3px solid transparent;
            transition: all 0.3s;
        }
        
        .blocking-tab.active {
            color: var(--primary);
            border-bottom-color: var(--primary);
        }
        
        .blocking-content {
            display: none;
        }
        
        .blocking-content.active {
            display: block;
        }
        
        .blocked-sites-list {
            max-height: 300px;
            overflow-y: auto;
            border: 1px solid #e1e5ee;
            border-radius: 8px;
            padding: 15px;
        }
        
        .blocked-site-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            border-bottom: 1px solid #f0f0f0;
        }
        
        .blocked-site-item:last-child {
            border-bottom: none;
        }
        
        /* Responsive Design */
        @media (max-width: 1024px) {
            .sidebar {
                width: 70px;
            }
            
            .sidebar-item span {
                display: none;
            }
            
            .main-content {
                margin-left: 70px;
            }
            
            .student-monitoring {
                grid-template-columns: 1fr;
            }
        }
        
        @media (max-width: 768px) {
            .sidebar {
                display: none;
            }
            
            .main-content {
                margin-left: 0;
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
            }
            
            .class-grid, .bypass-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <!-- Authentication Container -->
    <div class="auth-container" id="authContainer">
        <div class="auth-box">
            <div class="auth-logo">
                <h1>üè´ Class Stacks</h1>
                <p>Teacher Dashboard</p>
            </div>
            
            <div class="auth-tabs">
                <div class="auth-tab active" id="schoolTab" onclick="showAuthTab('school')">School Login</div>
                <div class="auth-tab" id="teacherTab" onclick="showAuthTab('teacher')">Teacher Login</div>
            </div>
            
            <!-- School Login Form -->
            <div id="schoolAuth">
                <div class="form-group">
                    <label for="schoolEmail">Email Address</label>
                    <input type="email" id="schoolEmail" placeholder="Enter your email" required>
                </div>
                
                <div class="form-group">
                    <label for="schoolPassword">Password</label>
                    <input type="password" id="schoolPassword" placeholder="Enter your password" required>
                </div>
                
                <button class="btn" onclick="loginSchool()">Login to School Account</button>
                
                <div class="auth-toggle">
                    <a href="#" onclick="showSchoolRegistration()">Don't have an account? Register</a>
                </div>
            </div>
            
            <!-- Teacher Login Form -->
            <div id="teacherAuth" style="display: none;">
                <div class="form-group">
                    <label for="teacherEmail">Email Address</label>
                    <input type="email" id="teacherEmail" placeholder="Enter your email" required>
                </div>
                
                <div class="form-group">
                    <label for="teacherPassword">Password</label>
                    <input type="password" id="teacherPassword" placeholder="Enter your password" required>
                </div>
                
                <button class="btn" onclick="loginTeacher()">Login as Teacher</button>
                
                <div class="auth-toggle">
                    <a href="#" onclick="showTeacherJoin()">Join a School as Teacher</a>
                </div>
            </div>
            
            <!-- School Registration Form -->
            <div id="schoolRegistration" style="display: none;">
                <h2 style="text-align: center; margin-bottom: 20px;">Create School Account</h2>
                
                <div class="form-group">
                    <label for="schoolName">School Name</label>
                    <input type="text" id="schoolName" placeholder="Enter your school name" required>
                </div>
                
                <div class="form-group">
                    <label for="schoolType">School Type</label>
                    <select id="schoolType" required>
                        <option value="">Select school type</option>
                        <option value="elementary">Elementary School</option>
                        <option value="middle">Middle School</option>
                        <option value="high">High School</option>
                        <option value="college">College/University</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="adminName">Administrator Name</label>
                    <input type="text" id="adminName" placeholder="Enter your full name" required>
                </div>
                
                <div class="form-group">
                    <label for="adminEmail">Email Address</label>
                    <input type="email" id="adminEmail" placeholder="Enter your email" required>
                </div>
                
                <div class="form-group">
                    <label for="adminPassword">Password</label>
                    <input type="password" id="adminPassword" placeholder="Create a password" required>
                </div>
                
                <button class="btn btn-success" onclick="registerSchool()">Create School Account</button>
                
                <div class="auth-toggle">
                    <a href="#" onclick="showSchoolLogin()">Already have an account? Login</a>
                </div>
            </div>
            
            <!-- Teacher Join Form -->
            <div id="teacherJoin" style="display: none;">
                <h2 style="text-align: center; margin-bottom: 20px;">Join School as Teacher</h2>
                
                <div class="form-group">
                    <label for="joinSchoolCode">School Code</label>
                    <input type="text" id="joinSchoolCode" placeholder="Enter school code" required>
                </div>
                
                <div class="form-group">
                    <label for="joinTeacherName">Your Name</label>
                    <input type="text" id="joinTeacherName" placeholder="Enter your full name" required>
                </div>
                
                <div class="form-group">
                    <label for="joinTeacherEmail">Email Address</label>
                    <input type="email" id="joinTeacherEmail" placeholder="Enter your email" required>
                </div>
                
                <div class="form-group">
                    <label for="joinTeacherPassword">Password</label>
                    <input type="password" id="joinTeacherPassword" placeholder="Create a password" required>
                </div>
                
                <button class="btn" onclick="joinAsTeacher()">Join School</button>
                
                <div class="auth-toggle">
                    <a href="#" onclick="showTeacherLogin()">Back to Teacher Login</a>
                </div>
            </div>
            
            <div class="error-message" id="errorMessage"></div>
            <div class="success-message" id="successMessage"></div>
        </div>
    </div>
    
    <!-- Teacher Dashboard -->
    <div class="dashboard" id="teacherDashboard">
        <div class="dashboard-header">
            <div class="header-left">
                <div class="logo">üè´ Class Stacks</div>
            </div>
            <div class="header-right">
                <div class="user-info">
                    <div class="user-avatar" id="userAvatar">T</div>
                    <div>
                        <div style="font-weight: 600;" id="userName">Teacher Name</div>
                        <div style="font-size: 0.8rem; color: #666;" id="userRole">Teacher</div>
                    </div>
                </div>
                <button class="btn btn-danger" onclick="logout()" style="padding: 8px 15px;">Logout</button>
            </div>
        </div>
        
        <div class="sidebar">
            <ul class="sidebar-menu">
                <li class="sidebar-item active" onclick="showDashboardView('overview')">
                    <span>üìä</span> <span>Overview</span>
                </li>
                <li class="sidebar-item" onclick="showDashboardView('classes')">
                    <span>üë®‚Äçüè´</span> <span>My Classes</span>
                </li>
                <li class="sidebar-item" onclick="showDashboardView('monitoring')">
                    <span>üëÅÔ∏è</span> <span>Student Monitoring</span>
                </li>
                <li class="sidebar-item" onclick="showDashboardView('blocking')">
                    <span>üö´</span> <span>Website Blocking</span>
                </li>
                <li class="sidebar-item" onclick="showDashboardView('bypass')">
                    <span>üîì</span> <span>Bypass Codes</span>
                </li>
                <li class="sidebar-item" onclick="showDashboardView('schedule')">
                    <span>üìÖ</span> <span>Schedule</span>
                </li>
                <li class="sidebar-item" onclick="showDashboardView('settings')">
                    <span>‚öôÔ∏è</span> <span>Settings</span>
                </li>
            </ul>
        </div>
        
        <div class="main-content">
            <!-- Overview View -->
            <div class="dashboard-view" id="overviewView">
                <div class="content-header">
                    <div class="content-title">Dashboard Overview</div>
                    <button class="btn" onclick="showCreateClassModal()" style="width: auto;">Create New Class</button>
                </div>
                
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-value" id="overviewClasses">0</div>
                        <div class="stat-label">My Classes</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="overviewStudents">0</div>
                        <div class="stat-label">Total Students</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="overviewActive">0</div>
                        <div class="stat-label">Active Now</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="overviewBypass">0</div>
                        <div class="stat-label">Bypass Active</div>
                    </div>
                </div>
                
                <div class="content-card">
                    <div class="card-header">
                        <div class="card-title">Recent Activity</div>
                    </div>
                    <div class="card-body">
                        <div id="recentActivity">
                            <p>No recent activity</p>
                        </div>
                    </div>
                </div>
                
                <div class="content-card">
                    <div class="card-header">
                        <div class="card-title">Active Students</div>
                    </div>
                    <div class="card-body">
                        <div id="activeStudentsList">
                            <p>No active students</p>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Classes View -->
            <div class="dashboard-view" id="classesView" style="display: none;">
                <div class="content-header">
                    <div class="content-title">My Classes</div>
                    <button class="btn" onclick="showCreateClassModal()" style="width: auto;">Create New Class</button>
                </div>
                
                <div class="class-grid" id="classesList">
                    <!-- Classes will be listed here -->
                </div>
            </div>
            
            <!-- Student Monitoring View -->
            <div class="dashboard-view" id="monitoringView" style="display: none;">
                <div class="content-header">
                    <div class="content-title">Student Monitoring</div>
                    <div>
                        <button class="control-btn warning" onclick="refreshAllScreens()">
                            <span>üîÑ</span> Refresh All Screens
                        </button>
                        <button class="control-btn danger" onclick="lockAllBrowsers()">
                            <span>üîí</span> Lock All Browsers
                        </button>
                    </div>
                </div>
                
                <div class="student-monitoring">
                    <div class="student-list-container">
                        <div class="student-list-header">
                            <div class="card-title">Students</div>
                            <div style="font-size: 0.9rem; color: #666;">
                                <span id="studentsCount">0</span> students
                            </div>
                        </div>
                        <div class="student-list" id="studentsList">
                            <!-- Students will be listed here -->
                        </div>
                    </div>
                    
                    <div class="student-detail-panel" id="studentDetailPanel">
                        <div class="student-detail-header">
                            <div class="card-title" id="detailStudentName">Select a Student</div>
                            <div class="student-info" id="detailStudentInfo"></div>
                            <div class="student-controls" id="studentControls" style="display: none;">
                                <button class="control-btn danger" onclick="lockStudent()">
                                    <span>üîí</span> Lock Browser
                                </button>
                                <button class="control-btn warning" onclick="requestScreenshot()">
                                    <span>üì∏</span> Request Screenshot
                                </button>
                                <button class="control-btn primary" onclick="showSendMessageModal()">
                                    <span>‚úâÔ∏è</span> Send Message
                                </button>
                                <button class="control-btn success" onclick="unlockStudent()">
                                    <span>üîì</span> Unlock Browser
                                </button>
                                <button class="control-btn danger" onclick="closeStudentTab()">
                                    <span>‚ùå</span> Close Tab
                                </button>
                            </div>
                        </div>
                        
                        <div class="student-tabs-container" id="studentTabsContainer" style="display: none;">
                            <div class="card-title">Open Tabs</div>
                            <div class="tabs-list" id="studentTabsList">
                                <!-- Student tabs will be listed here -->
                            </div>
                        </div>
                        
                        <div class="screen-view">
                            <div class="screen-container">
                                <canvas id="studentScreen" class="screen-canvas" width="800" height="450"></canvas>
                                <div id="screenPlaceholder" class="screen-placeholder">
                                    <div class="screen-placeholder-icon">üñ•Ô∏è</div>
                                    <h3>No Student Selected</h3>
                                    <p>Select a student to view their screen and activity</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Website Blocking View -->
            <div class="dashboard-view" id="blockingView" style="display: none;">
                <div class="content-header">
                    <div class="content-title">Website Blocking</div>
                </div>
                
                <div class="blocking-tabs">
                    <div class="blocking-tab active" onclick="showBlockingTab('school')">School-Wide Blocking</div>
                    <div class="blocking-tab" onclick="showBlockingTab('class')">Class-Specific Blocking</div>
                </div>
                
                <!-- School-Wide Blocking -->
                <div class="blocking-content active" id="schoolBlocking">
                    <div class="content-card">
                        <div class="card-header">
                            <div class="card-title">School-Wide Blocked Websites</div>
                            <div style="font-size: 0.9rem; color: #666;">
                                <span id="schoolCodeDisplay">School Code: Loading...</span>
                            </div>
                        </div>
                        <div class="card-body">
                            <div class="form-group">
                                <label for="schoolBlockedSites">Blocked Websites (one per line)</label>
                                <textarea id="schoolBlockedSites" rows="8" placeholder="facebook.com&#10;youtube.com&#10;instagram.com"></textarea>
                            </div>
                            
                            <button class="btn btn-success" onclick="saveSchoolBlockedSites()">Save School-Wide Blocking</button>
                            
                            <div class="blocked-sites-list" id="schoolBlockedSitesList" style="margin-top: 20px;">
                                <!-- Blocked sites will be listed here -->
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Class-Specific Blocking -->
                <div class="blocking-content" id="classBlocking">
                    <div class="content-card">
                        <div class="card-header">
                            <div class="card-title">Class-Specific Blocking</div>
                        </div>
                        <div class="card-body">
                            <div class="form-group">
                                <label for="classBlockingSelect">Select Class</label>
                                <select id="classBlockingSelect" onchange="loadClassBlocking()">
                                    <option value="">Select a class</option>
                                </select>
                            </div>
                            
                            <div id="classBlockingContent" style="display: none;">
                                <div class="form-group">
                                    <label for="classBlockedSites">Blocked Websites for <span id="selectedClassName">Selected Class</span> (one per line)</label>
                                    <textarea id="classBlockedSites" rows="8" placeholder="facebook.com&#10;youtube.com&#10;instagram.com"></textarea>
                                </div>
                                
                                <div class="form-group">
                                    <label>
                                        <input type="checkbox" id="classAllowBrowsing"> Allow browsing (uncheck to completely lock browser)
                                    </label>
                                </div>
                                
                                <button class="btn btn-success" onclick="saveClassBlocking()">Save Class Blocking</button>
                                
                                <div class="blocked-sites-list" id="classBlockedSitesList" style="margin-top: 20px;">
                                    <!-- Class blocked sites will be listed here -->
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Bypass Codes View -->
            <div class="dashboard-view" id="bypassView" style="display: none;">
                <div class="content-header">
                    <div class="content-title">Bypass Codes</div>
                    <button class="btn" onclick="showCreateBypassModal()" style="width: auto;">Create New Code</button>
                </div>
                
                <div class="bypass-grid" id="bypassCodesList">
                    <!-- Bypass codes will be listed here -->
                </div>
            </div>
            
            <!-- Schedule View -->
            <div class="dashboard-view" id="scheduleView" style="display: none;">
                <div class="content-header">
                    <div class="content-title">Class Schedule</div>
                    <button class="btn" onclick="showCreateScheduleModal()" style="width: auto;">Add Schedule</button>
                </div>
                
                <div class="content-card">
                    <div class="card-body">
                        <div class="schedule-list" id="scheduleList">
                            <!-- Schedules will be listed here -->
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Settings View -->
            <div class="dashboard-view" id="settingsView" style="display: none;">
                <div class="content-header">
                    <div class="content-title">Settings</div>
                </div>
                
                <div class="content-card">
                    <div class="card-header">
                        <div class="card-title">Account Settings</div>
                    </div>
                    <div class="card-body">
                        <div class="form-group">
                            <label for="settingsName">Your Name</label>
                            <input type="text" id="settingsName" value="Teacher Name">
                        </div>
                        
                        <div class="form-group">
                            <label for="settingsEmail">Email Address</label>
                            <input type="email" id="settingsEmail" value="teacher@example.com">
                        </div>
                        
                        <button class="btn" style="width: auto;">Save Changes</button>
                    </div>
                </div>
                
                <div class="content-card">
                    <div class="card-header">
                        <div class="card-title">School Information</div>
                    </div>
                    <div class="card-body">
                        <div class="form-group">
                            <label>School Code</label>
                            <div style="padding: 14px; background: #f8f9fa; border-radius: 8px; font-family: monospace; font-size: 1.2rem; font-weight: bold;" id="settingsSchoolCode">
                                Loading...
                            </div>
                            <div style="font-size: 0.8rem; color: #666; margin-top: 5px;">
                                Share this code with teachers to join your school
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Create Class Modal -->
    <div class="modal" id="createClassModal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">Create New Class</div>
                <button class="modal-close" onclick="closeModal('createClassModal')">√ó</button>
            </div>
            
            <div class="form-group">
                <label for="className">Class Name</label>
                <input type="text" id="className" placeholder="e.g., Math Grade 5">
            </div>
            
            <div class="form-group">
                <label for="classSubject">Subject</label>
                <input type="text" id="classSubject" placeholder="e.g., Mathematics">
            </div>
            
            <div class="form-group">
                <label for="classGrade">Grade Level</label>
                <input type="text" id="classGrade" placeholder="e.g., Grade 5">
            </div>
            
            <div class="form-group">
                <label for="classDescription">Description (Optional)</label>
                <textarea id="classDescription" rows="3" placeholder="Brief description of the class"></textarea>
            </div>
            
            <button class="btn btn-success" onclick="createClass()">Create Class</button>
        </div>
    </div>
    
    <!-- Create Bypass Code Modal -->
    <div class="modal" id="createBypassModal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">Create Bypass Code</div>
                <button class="modal-close" onclick="closeModal('createBypassModal')">√ó</button>
            </div>
            
            <div class="form-group">
                <label for="bypassCode">Bypass Code</label>
                <input type="text" id="bypassCode" placeholder="Enter code or generate automatically">
                <button class="btn" style="margin-top: 10px; width: auto;" onclick="generateBypassCode()">Generate Code</button>
            </div>
            
            <div class="form-group">
                <label for="bypassExpiry">Expiry Time</label>
                <select id="bypassExpiry">
                    <option value="30">30 minutes</option>
                    <option value="60">1 hour</option>
                    <option value="120">2 hours</option>
                    <option value="240">4 hours</option>
                    <option value="480">8 hours</option>
                    <option value="1440">24 hours</option>
                </select>
            </div>
            
            <div class="form-group">
                <label for="bypassUsage">Maximum Usage</label>
                <input type="number" id="bypassUsage" placeholder="Number of times it can be used" value="1">
            </div>
            
            <button class="btn btn-success" onclick="createBypassCode()">Create Bypass Code</button>
        </div>
    </div>
    
    <!-- Create Schedule Modal -->
    <div class="modal" id="createScheduleModal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">Add Class Schedule</div>
                <button class="modal-close" onclick="closeModal('createScheduleModal')">√ó</button>
            </div>
            
            <div class="form-group">
                <label for="scheduleClass">Select Class</label>
                <select id="scheduleClass">
                    <!-- Classes will be populated here -->
                </select>
            </div>
            
            <div class="form-group">
                <label for="scheduleDate">Date</label>
                <input type="date" id="scheduleDate">
            </div>
            
            <div class="form-group">
                <label for="scheduleStartTime">Start Time</label>
                <input type="time" id="scheduleStartTime">
            </div>
            
            <div class="form-group">
                <label for="scheduleEndTime">End Time</label>
                <input type="time" id="scheduleEndTime">
            </div>
            
            <div class="form-group">
                <label for="scheduleRecurring">Recurring</label>
                <select id="scheduleRecurring">
                    <option value="none">No Recurrence</option>
                    <option value="daily">Daily</option>
                    <option value="weekly">Weekly</option>
                    <option value="monthly">Monthly</option>
                </select>
            </div>
            
            <button class="btn btn-success" onclick="createSchedule()">Add Schedule</button>
        </div>
    </div>
    
    <!-- Send Message Modal -->
    <div class="modal" id="sendMessageModal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">Send Message to Student</div>
                <button class="modal-close" onclick="closeModal('sendMessageModal')">√ó</button>
            </div>
            
            <div class="form-group">
                <label for="messageText">Message</label>
                <textarea id="messageText" rows="4" placeholder="Type your message to the student"></textarea>
            </div>
            
            <button class="btn btn-success" onclick="sendMessageToStudent()">Send Message</button>
        </div>
    </div>

    <script>
        // Global variables
        let currentUser = null;
        let currentSchool = null;
        let currentView = 'overview';
        let selectedStudentId = null;
        let updateInterval;
        
        // Initialize the application
        function initializeApp() {
            // Check if user is already logged in
            const savedUser = localStorage.getItem('currentUser');
            const savedSchool = localStorage.getItem('currentSchool');
            
            if (savedUser && savedSchool) {
                currentUser = JSON.parse(savedUser);
                currentSchool = JSON.parse(savedSchool);
                showTeacherDashboard();
            } else {
                showAuthTab('school');
            }
            
            // Initialize data structure if it doesn't exist
            if (!localStorage.getItem('classStacksData')) {
                const initialData = {
                    schools: {},
                    teachers: {},
                    classes: {},
                    students: {},
                    classSettings: {},
                    teacherControl: {},
                    messages: {},
                    studentLocks: {},
                    screenshots: {},
                    bypassCodes: {},
                    schedules: {},
                    activityLogs: {},
                    lastUpdated: Date.now()
                };
                localStorage.setItem('classStacksData', JSON.stringify(initialData));
            }
        }
        
        // Show authentication tab
        function showAuthTab(tab) {
            document.getElementById('schoolTab').classList.remove('active');
            document.getElementById('teacherTab').classList.remove('active');
            
            document.getElementById('schoolAuth').style.display = 'none';
            document.getElementById('teacherAuth').style.display = 'none';
            document.getElementById('schoolRegistration').style.display = 'none';
            document.getElementById('teacherJoin').style.display = 'none';
            
            if (tab === 'school') {
                document.getElementById('schoolTab').classList.add('active');
                document.getElementById('schoolAuth').style.display = 'block';
            } else {
                document.getElementById('teacherTab').classList.add('active');
                document.getElementById('teacherAuth').style.display = 'block';
            }
        }
        
        // Show school registration
        function showSchoolRegistration() {
            document.getElementById('schoolAuth').style.display = 'none';
            document.getElementById('schoolRegistration').style.display = 'block';
        }
        
        // Show school login
        function showSchoolLogin() {
            document.getElementById('schoolRegistration').style.display = 'none';
            document.getElementById('schoolAuth').style.display = 'block';
        }
        
        // Show teacher join
        function showTeacherJoin() {
            document.getElementById('teacherAuth').style.display = 'none';
            document.getElementById('teacherJoin').style.display = 'block';
        }
        
        // Show teacher login
        function showTeacherLogin() {
            document.getElementById('teacherJoin').style.display = 'none';
            document.getElementById('teacherAuth').style.display = 'block';
        }
        
        // Register a new school
        function registerSchool() {
            const schoolName = document.getElementById('schoolName').value;
            const schoolType = document.getElementById('schoolType').value;
            const adminName = document.getElementById('adminName').value;
            const adminEmail = document.getElementById('adminEmail').value;
            const adminPassword = document.getElementById('adminPassword').value;
            
            if (!schoolName || !schoolType || !adminName || !adminEmail || !adminPassword) {
                showError('Please fill in all required fields');
                return;
            }
            
            if (adminPassword.length < 6) {
                showError('Password must be at least 6 characters long');
                return;
            }
            
            const data = getSharedData();
            
            // Check if email already exists
            const existingUser = Object.values(data.teachers).find(teacher => 
                teacher.email === adminEmail
            );
            
            if (existingUser) {
                showError('A user with this email already exists');
                return;
            }
            
            // Generate school ID and code
            const schoolId = 'school_' + Date.now();
            const schoolCode = generateSchoolCode();
            
            // Create school
            data.schools[schoolId] = {
                id: schoolId,
                name: schoolName,
                type: schoolType,
                code: schoolCode,
                created: Date.now(),
                owner: adminEmail,
                blockedSites: [
                    'youtube.com', 'facebook.com', 'tiktok.com', 'instagram.com', 
                    'netflix.com', 'twitter.com', 'snapchat.com', 'reddit.com', 
                    'twitch.tv', 'porn', 'xxx', 'adult', 'gambling'
                ]
            };
            
            // Create admin teacher
            const teacherId = 'teacher_' + Date.now();
            data.teachers[teacherId] = {
                id: teacherId,
                name: adminName,
                email: adminEmail,
                password: adminPassword,
                schoolId: schoolId,
                role: 'owner',
                created: Date.now()
            };
            
            // Save data
            saveSharedData(data);
            
            // Set current user and school
            currentUser = data.teachers[teacherId];
            currentSchool = data.schools[schoolId];
            
            // Save to localStorage
            localStorage.setItem('currentUser', JSON.stringify(currentUser));
            localStorage.setItem('currentSchool', JSON.stringify(currentSchool));
            
            // Show success message and dashboard
            showSuccess('School account created successfully!');
            setTimeout(() => {
                showTeacherDashboard();
            }, 1500);
        }
        
        // Login to school account
        function loginSchool() {
            const email = document.getElementById('schoolEmail').value;
            const password = document.getElementById('schoolPassword').value;
            
            if (!email || !password) {
                showError('Please enter both email and password');
                return;
            }
            
            const data = getSharedData();
            
            // Find teacher with matching credentials
            const teacher = Object.values(data.teachers).find(t => 
                t.email === email && t.password === password
            );
            
            if (teacher) {
                // Get school data
                const school = data.schools[teacher.schoolId];
                
                if (school) {
                    currentUser = teacher;
                    currentSchool = school;
                    
                    // Save to localStorage
                    localStorage.setItem('currentUser', JSON.stringify(currentUser));
                    localStorage.setItem('currentSchool', JSON.stringify(currentSchool));
                    
                    showTeacherDashboard();
                } else {
                    showError('School not found');
                }
            } else {
                showError('Invalid email or password');
            }
        }
        
        // Login as teacher
        function loginTeacher() {
            const email = document.getElementById('teacherEmail').value;
            const password = document.getElementById('teacherPassword').value;
            
            if (!email || !password) {
                showError('Please enter both email and password');
                return;
            }
            
            const data = getSharedData();
            
            // Find teacher with matching credentials
            const teacher = Object.values(data.teachers).find(t => 
                t.email === email && t.password === password
            );
            
            if (teacher) {
                // Get school data
                const school = data.schools[teacher.schoolId];
                
                if (school) {
                    currentUser = teacher;
                    currentSchool = school;
                    
                    // Save to localStorage
                    localStorage.setItem('currentUser', JSON.stringify(currentUser));
                    localStorage.setItem('currentSchool', JSON.stringify(currentSchool));
                    
                    showTeacherDashboard();
                } else {
                    showError('School not found');
                }
            } else {
                showError('Invalid email or password');
            }
        }
        
        // Join school as teacher
        function joinAsTeacher() {
            const schoolCode = document.getElementById('joinSchoolCode').value;
            const teacherName = document.getElementById('joinTeacherName').value;
            const teacherEmail = document.getElementById('joinTeacherEmail').value;
            const teacherPassword = document.getElementById('joinTeacherPassword').value;
            
            if (!schoolCode || !teacherName || !teacherEmail || !teacherPassword) {
                showError('Please fill in all fields');
                return;
            }
            
            if (teacherPassword.length < 6) {
                showError('Password must be at least 6 characters long');
                return;
            }
            
            const data = getSharedData();
            
            // Find school with matching code
            const school = Object.values(data.schools).find(s => 
                s.code === schoolCode.toUpperCase()
            );
            
            if (!school) {
                showError('Invalid school code');
                return;
            }
            
            // Check if email already exists
            const existingUser = Object.values(data.teachers).find(teacher => 
                teacher.email === teacherEmail
            );
            
            if (existingUser) {
                showError('A user with this email already exists');
                return;
            }
            
            // Create teacher account
            const teacherId = 'teacher_' + Date.now();
            data.teachers[teacherId] = {
                id: teacherId,
                name: teacherName,
                email: teacherEmail,
                password: teacherPassword,
                schoolId: school.id,
                role: 'teacher',
                created: Date.now()
            };
            
            // Save data
            saveSharedData(data);
            
            // Set current user and school
            currentUser = data.teachers[teacherId];
            currentSchool = school;
            
            // Save to localStorage
            localStorage.setItem('currentUser', JSON.stringify(currentUser));
            localStorage.setItem('currentSchool', JSON.stringify(currentSchool));
            
            // Show success message and dashboard
            showSuccess('Successfully joined school!');
            setTimeout(() => {
                showTeacherDashboard();
            }, 1500);
        }
        
        // Show teacher dashboard
        function showTeacherDashboard() {
            document.getElementById('authContainer').style.display = 'none';
            document.getElementById('teacherDashboard').style.display = 'block';
            
            // Update dashboard with current data
            updateTeacherDashboard();
            
            // Start monitoring for updates
            startMonitoring();
        }
        
        // Update teacher dashboard with current data
        function updateTeacherDashboard() {
            if (!currentSchool || !currentUser) return;
            
            const data = getSharedData();
            
            // Update user info
            document.getElementById('userName').textContent = currentUser.name;
            document.getElementById('userAvatar').textContent = currentUser.name.charAt(0).toUpperCase();
            document.getElementById('userRole').textContent = currentUser.role === 'owner' ? 'School Admin' : 'Teacher';
            
            // Update current view
            updateDashboardView();
        }
        
        // Show dashboard view
        function showDashboardView(view) {
            currentView = view;
            
            // Update sidebar active item
            document.querySelectorAll('.sidebar-item').forEach(item => {
                item.classList.remove('active');
            });
            
            document.querySelectorAll('.dashboard-view').forEach(view => {
                view.style.display = 'none';
            });
            
            document.getElementById(view + 'View').style.display = 'block';
            
            // Update the view
            updateDashboardView();
        }
        
        // Update current dashboard view
        function updateDashboardView() {
            const data = getSharedData();
            
            switch (currentView) {
                case 'overview':
                    updateOverviewView(data);
                    break;
                case 'classes':
                    updateClassesView(data);
                    break;
                case 'monitoring':
                    updateMonitoringView(data);
                    break;
                case 'blocking':
                    updateBlockingView(data);
                    break;
                case 'bypass':
                    updateBypassView(data);
                    break;
                case 'schedule':
                    updateScheduleView(data);
                    break;
                case 'settings':
                    updateSettingsView(data);
                    break;
            }
        }
        
        // Update overview view
        function updateOverviewView(data) {
            // Get teacher's classes
            const teacherClasses = Object.values(data.classes).filter(c => 
                c.teacherId === currentUser.id
            );
            
            // Get students in teacher's classes
            const teacherStudents = Object.values(data.students).filter(s => 
                teacherClasses.some(c => c.id === s.classId)
            );
            
            // Count active students
            const activeStudents = teacherStudents.filter(s => 
                s.lastActive && (Date.now() - s.lastActive) < 30000
            );
            
            // Count students with bypass active
            const bypassStudents = teacherStudents.filter(s => s.bypassActive);
            
            // Update stats
            document.getElementById('overviewClasses').textContent = teacherClasses.length;
            document.getElementById('overviewStudents').textContent = teacherStudents.length;
            document.getElementById('overviewActive').textContent = activeStudents.length;
            document.getElementById('overviewBypass').textContent = bypassStudents.length;
            
            // Update recent activity
            updateRecentActivity(data);
            
            // Update active students list
            updateActiveStudentsList(activeStudents, data);
        }
        
        // Update recent activity
        function updateRecentActivity(data) {
            const activityContainer = document.getElementById('recentActivity');
            activityContainer.innerHTML = '';
            
            // Get recent activity logs
            const allLogs = [];
            Object.values(data.activityLogs || {}).forEach(logs => {
                logs.forEach(log => {
                    allLogs.push(log);
                });
            });
            
            // Sort by timestamp (newest first)
            allLogs.sort((a, b) => b.timestamp - a.timestamp);
            
            // Get last 5 activities
            const recentLogs = allLogs.slice(0, 5);
            
            if (recentLogs.length === 0) {
                activityContainer.innerHTML = '<p>No recent activity</p>';
                return;
            }
            
            recentLogs.forEach(log => {
                const logElement = document.createElement('div');
                logElement.style.padding = '10px 0';
                logElement.style.borderBottom = '1px solid #f0f0f0';
                
                const time = new Date(log.timestamp).toLocaleTimeString();
                logElement.innerHTML = `
                    <div style="font-weight: 500;">${log.action}</div>
                    <div style="font-size: 0.8rem; color: #666;">${time}</div>
                `;
                
                activityContainer.appendChild(logElement);
            });
        }
        
        // Update active students list
        function updateActiveStudentsList(activeStudents, data) {
            const container = document.getElementById('activeStudentsList');
            container.innerHTML = '';
            
            if (activeStudents.length === 0) {
                container.innerHTML = '<p>No active students</p>';
                return;
            }
            
            activeStudents.forEach(student => {
                // Get class info
                const studentClass = data.classes[student.classId];
                const className = studentClass ? studentClass.name : 'Unknown Class';
                
                const studentElement = document.createElement('div');
                studentElement.style.padding = '15px';
                studentElement.style.borderBottom = '1px solid #f0f0f0';
                studentElement.style.cursor = 'pointer';
                
                studentElement.innerHTML = `
                    <div style="display: flex; justify-content: between; align-items: center; margin-bottom: 8px;">
                        <div style="font-weight: 600;">${student.name}</div>
                        <div style="background: #e7f7e9; color: #27ae60; padding: 3px 8px; border-radius: 12px; font-size: 0.8rem; font-weight: 600;">Online</div>
                    </div>
                    <div style="font-size: 0.9rem; color: #666;">${className}</div>
                    <div style="font-size: 0.8rem; color: #888; margin-top: 5px;">
                        ${student.currentUrl ? `Browsing: ${student.currentUrl}` : 'Not browsing'}
                    </div>
                `;
                
                studentElement.addEventListener('click', () => {
                    showDashboardView('monitoring');
                    selectStudent(student.id);
                });
                
                container.appendChild(studentElement);
            });
        }
        
        // Update classes view
        function updateClassesView(data) {
            const classesList = document.getElementById('classesList');
            classesList.innerHTML = '';
            
            // Get teacher's classes
            const teacherClasses = Object.values(data.classes).filter(c => 
                c.teacherId === currentUser.id
            );
            
            if (teacherClasses.length === 0) {
                classesList.innerHTML = '<p>No classes created yet</p>';
                return;
            }
            
            teacherClasses.forEach(classItem => {
                // Count students in this class
                const classStudents = Object.values(data.students).filter(s => 
                    s.classId === classItem.id
                );
                
                // Count active students
                const activeStudents = classStudents.filter(s => 
                    s.lastActive && (Date.now() - s.lastActive) < 30000
                );
                
                const classCard = document.createElement('div');
                classCard.className = 'class-card';
                classCard.onclick = () => {
                    // FIXED: This now properly switches to monitoring view
                    showDashboardView('monitoring');
                    // You could also filter students by this class here
                };
                
                classCard.innerHTML = `
                    <div class="class-header">
                        <div class="class-name">${classItem.name}</div>
                        <div class="class-code">${classItem.code}</div>
                    </div>
                    <div class="class-info">
                        ${classItem.subject} ‚Ä¢ ${classItem.grade}
                        ${classItem.description ? `<br>${classItem.description}` : ''}
                    </div>
                    <div class="class-stats">
                        <div class="class-stat">
                            <div class="class-stat-value">${classStudents.length}</div>
                            <div class="class-stat-label">Students</div>
                        </div>
                        <div class="class-stat">
                            <div class="class-stat-value">${activeStudents.length}</div>
                            <div class="class-stat-label">Active</div>
                        </div>
                    </div>
                `;
                
                classesList.appendChild(classCard);
            });
        }
        
        // Update monitoring view
        function updateMonitoringView(data) {
            const studentsList = document.getElementById('studentsList');
            studentsList.innerHTML = '';
            
            // Get teacher's classes
            const teacherClasses = Object.values(data.classes).filter(c => 
                c.teacherId === currentUser.id
            );
            
            // Get students in teacher's classes
            const teacherStudents = Object.values(data.students).filter(s => 
                teacherClasses.some(c => c.id === s.classId)
            );
            
            // Update students count
            document.getElementById('studentsCount').textContent = teacherStudents.length;
            
            if (teacherStudents.length === 0) {
                studentsList.innerHTML = '<p>No students connected yet</p>';
                return;
            }
            
            teacherStudents.forEach(student => {
                // Get class info
                const studentClass = data.classes[student.classId];
                const className = studentClass ? studentClass.name : 'Unknown Class';
                
                // Determine status
                const isOnline = student.lastActive && (Date.now() - student.lastActive) < 30000;
                const isBypassing = student.bypassActive;
                
                let statusText = isOnline ? 'Online' : 'Offline';
                let statusClass = isOnline ? 'status-online' : 'status-offline';
                
                if (isBypassing) {
                    statusText = 'Bypass Active';
                    statusClass = 'status-bypass';
                }
                
                const studentCard = document.createElement('div');
                studentCard.className = `student-card ${selectedStudentId === student.id ? 'active' : ''}`;
                studentCard.dataset.studentId = student.id;
                
                studentCard.innerHTML = `
                    <div class="student-header">
                        <div class="student-name">${student.name}</div>
                        <div class="student-status ${statusClass}">${statusText}</div>
                    </div>
                    <div class="student-info">
                        ${className} ‚Ä¢ ${student.device || 'Unknown Device'}
                    </div>
                    <div style="font-size: 0.8rem; color: #888; margin-top: 5px;">
                        ${student.currentUrl ? `Browsing: ${student.currentUrl}` : 'Not browsing'}
                    </div>
                    ${student.tabs && student.tabs.length > 0 ? `
                        <div class="student-tabs-preview">
                            ${student.tabs.slice(0, 3).map(tab => 
                                `<div class="tab-preview ${student.activeTab === student.tabs.indexOf(tab) ? 'active' : ''}">${tab.title || 'Untitled'}</div>`
                            ).join('')}
                            ${student.tabs.length > 3 ? `<div class="tab-preview">+${student.tabs.length - 3} more</div>` : ''}
                        </div>
                    ` : ''}
                `;
                
                studentCard.addEventListener('click', () => {
                    selectStudent(student.id);
                });
                
                studentsList.appendChild(studentCard);
            });
            
            // Update selected student details if any
            if (selectedStudentId) {
                const student = data.students[selectedStudentId];
                if (student) {
                    updateStudentDetails(student, data);
                }
            }
        }
        
        // Update blocking view
        function updateBlockingView(data) {
            // Update school code display
            document.getElementById('schoolCodeDisplay').textContent = `School Code: ${currentSchool.code}`;
            
            // Update school-wide blocked sites
            updateSchoolBlockedSitesList();
            
            // Update class selection dropdown
            updateClassBlockingDropdown();
        }
        
        // Update school blocked sites list
        function updateSchoolBlockedSitesList() {
            const blockedSitesList = document.getElementById('schoolBlockedSitesList');
            const schoolBlockedSites = currentSchool.blockedSites || [];
            
            // Update textarea
            document.getElementById('schoolBlockedSites').value = schoolBlockedSites.join('\n');
            
            // Update list display
            blockedSitesList.innerHTML = '';
            
            if (schoolBlockedSites.length === 0) {
                blockedSitesList.innerHTML = '<p>No sites blocked school-wide</p>';
                return;
            }
            
            schoolBlockedSites.forEach(site => {
                const siteItem = document.createElement('div');
                siteItem.className = 'blocked-site-item';
                siteItem.innerHTML = `
                    <div>${site}</div>
                    <button class="btn btn-danger" style="padding: 5px 10px;" onclick="removeSchoolBlockedSite('${site}')">Remove</button>
                `;
                blockedSitesList.appendChild(siteItem);
            });
        }
        
        // Update class blocking dropdown
        function updateClassBlockingDropdown() {
            const classSelect = document.getElementById('classBlockingSelect');
            classSelect.innerHTML = '<option value="">Select a class</option>';
            
            const data = getSharedData();
            const teacherClasses = Object.values(data.classes).filter(c => 
                c.teacherId === currentUser.id
            );
            
            teacherClasses.forEach(classItem => {
                const option = document.createElement('option');
                option.value = classItem.id;
                option.textContent = classItem.name;
                classSelect.appendChild(option);
            });
        }
        
        // Show blocking tab
        function showBlockingTab(tab) {
            document.querySelectorAll('.blocking-tab').forEach(t => {
                t.classList.remove('active');
            });
            
            document.querySelectorAll('.blocking-content').forEach(c => {
                c.classList.remove('active');
            });
            
            document.getElementById(tab + 'Blocking').classList.add('active');
            document.querySelector(`.blocking-tab[onclick="showBlockingTab('${tab}')"]`).classList.add('active');
        }
        
        // Load class blocking settings
        function loadClassBlocking() {
            const classId = document.getElementById('classBlockingSelect').value;
            const classBlockingContent = document.getElementById('classBlockingContent');
            
            if (!classId) {
                classBlockingContent.style.display = 'none';
                return;
            }
            
            const data = getSharedData();
            const classItem = data.classes[classId];
            
            if (!classItem) {
                classBlockingContent.style.display = 'none';
                return;
            }
            
            // Update class name
            document.getElementById('selectedClassName').textContent = classItem.name;
            
            // Get class settings
            const classSettings = data.classSettings && data.classSettings[classId] ? 
                data.classSettings[classId] : {
                    blockedSites: [],
                    allowBrowsing: true
                };
            
            // Update form fields
            document.getElementById('classBlockedSites').value = classSettings.blockedSites.join('\n');
            document.getElementById('classAllowBrowsing').checked = classSettings.allowBrowsing !== false;
            
            // Update blocked sites list
            updateClassBlockedSitesList(classSettings.blockedSites);
            
            // Show content
            classBlockingContent.style.display = 'block';
        }
        
        // Update class blocked sites list
        function updateClassBlockedSitesList(blockedSites) {
            const blockedSitesList = document.getElementById('classBlockedSitesList');
            blockedSitesList.innerHTML = '';
            
            if (blockedSites.length === 0) {
                blockedSitesList.innerHTML = '<p>No sites blocked for this class</p>';
                return;
            }
            
            blockedSites.forEach(site => {
                const siteItem = document.createElement('div');
                siteItem.className = 'blocked-site-item';
                siteItem.innerHTML = `
                    <div>${site}</div>
                    <button class="btn btn-danger" style="padding: 5px 10px;" onclick="removeClassBlockedSite('${site}')">Remove</button>
                `;
                blockedSitesList.appendChild(siteItem);
            });
        }
        
        // Save school-wide blocked sites
        function saveSchoolBlockedSites() {
            const blockedSitesText = document.getElementById('schoolBlockedSites').value;
            const blockedSites = blockedSitesText.split('\n')
                .map(site => site.trim())
                .filter(site => site.length > 0);
            
            currentSchool.blockedSites = blockedSites;
            
            const data = getSharedData();
            data.schools[currentSchool.id] = currentSchool;
            saveSharedData(data);
            
            updateSchoolBlockedSitesList();
            showSuccess('School-wide blocking settings saved!');
        }
        
        // Remove school blocked site
        function removeSchoolBlockedSite(site) {
            currentSchool.blockedSites = currentSchool.blockedSites.filter(s => s !== site);
            
            const data = getSharedData();
            data.schools[currentSchool.id] = currentSchool;
            saveSharedData(data);
            
            updateSchoolBlockedSitesList();
        }
        
        // Save class blocking settings
        function saveClassBlocking() {
            const classId = document.getElementById('classBlockingSelect').value;
            if (!classId) {
                showError('Please select a class first');
                return;
            }
            
            const blockedSitesText = document.getElementById('classBlockedSites').value;
            const blockedSites = blockedSitesText.split('\n')
                .map(site => site.trim())
                .filter(site => site.length > 0);
            
            const allowBrowsing = document.getElementById('classAllowBrowsing').checked;
            
            const data = getSharedData();
            if (!data.classSettings) data.classSettings = {};
            data.classSettings[classId] = {
                blockedSites: blockedSites,
                allowBrowsing: allowBrowsing,
                blockingEnabled: true
            };
            
            saveSharedData(data);
            updateClassBlockedSitesList(blockedSites);
            showSuccess('Class blocking settings saved!');
        }
        
        // Remove class blocked site
        function removeClassBlockedSite(site) {
            const classId = document.getElementById('classBlockingSelect').value;
            if (!classId) return;
            
            const data = getSharedData();
            if (!data.classSettings) data.classSettings = {};
            if (!data.classSettings[classId]) return;
            
            data.classSettings[classId].blockedSites = data.classSettings[classId].blockedSites.filter(s => s !== site);
            saveSharedData(data);
            
            loadClassBlocking();
        }
        
        // Select a student for monitoring
        function selectStudent(studentId) {
            selectedStudentId = studentId;
            
            // Update student cards
            document.querySelectorAll('.student-card').forEach(card => {
                card.classList.remove('active');
                if (card.dataset.studentId === studentId) {
                    card.classList.add('active');
                }
            });
            
            // Update student details
            const data = getSharedData();
            const student = data.students[studentId];
            if (student) {
                updateStudentDetails(student, data);
            }
        }
        
        // Update student details in monitoring view
        function updateStudentDetails(student, data) {
            // Get class info
            const studentClass = data.classes[student.classId];
            const className = studentClass ? studentClass.name : 'Unknown Class';
            
            // Update student info
            document.getElementById('detailStudentName').textContent = student.name;
            document.getElementById('detailStudentInfo').textContent = `${className} ‚Ä¢ ${student.device || 'Unknown Device'}`;
            
            // Show controls
            document.getElementById('studentControls').style.display = 'flex';
            document.getElementById('studentTabsContainer').style.display = 'block';
            
            // Update student tabs
            updateStudentTabs(student);
            
            // Update student screen
            updateStudentScreen(student, data);
        }
        
        // Update student tabs
        function updateStudentTabs(student) {
            const tabsList = document.getElementById('studentTabsList');
            tabsList.innerHTML = '';
            
            if (!student.tabs || student.tabs.length === 0) {
                tabsList.innerHTML = '<p>No tabs open</p>';
                return;
            }
            
            student.tabs.forEach((tab, index) => {
                const tabItem = document.createElement('div');
                tabItem.className = `tab-item ${student.activeTab === index ? 'active' : ''}`;
                
                tabItem.innerHTML = `
                    <div class="tab-favicon">${tab.favicon || 'üåê'}</div>
                    <div class="tab-details">
                        <div class="tab-title">${tab.title || 'Untitled'}</div>
                        <div class="tab-url">${tab.url || ''}</div>
                    </div>
                    <div class="tab-close" onclick="event.stopPropagation(); closeStudentTab(${index})">√ó</div>
                `;
                
                tabsList.appendChild(tabItem);
            });
        }
        
        // Update student screen
        function updateStudentScreen(student, data) {
            const canvas = document.getElementById('studentScreen');
            const ctx = canvas.getContext('2d');
            const placeholder = document.getElementById('screenPlaceholder');
            
            // Check if we have a recent screenshot
            const screenshots = data.screenshots || {};
            const studentScreenshot = screenshots[student.id];
            
            if (studentScreenshot && studentScreenshot.imageData && 
                (Date.now() - studentScreenshot.timestamp) < 5000) {
                // We have a recent screenshot, display it
                const img = new Image();
                img.onload = function() {
                    ctx.clearRect(0, 0, canvas.width, canvas.height);
                    ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
                    placeholder.style.display = 'none';
                    canvas.style.display = 'block';
                };
                img.src = studentScreenshot.imageData;
            } else {
                // No recent screenshot, show placeholder
                canvas.style.display = 'none';
                placeholder.style.display = 'flex';
                placeholder.innerHTML = `
                    <div class="screen-placeholder-icon">üñ•Ô∏è</div>
                    <h3>No Screen Data Available</h3>
                    <p>Student screen will appear here when available</p>
                `;
            }
        }
        
        // Update bypass view
        function updateBypassView(data) {
            const bypassList = document.getElementById('bypassCodesList');
            bypassList.innerHTML = '';
            
            const teacherBypassCodes = Object.values(data.bypassCodes || {}).filter(b => 
                b.teacherId === currentUser.id
            );
            
            if (teacherBypassCodes.length === 0) {
                bypassList.innerHTML = '<p>No bypass codes created yet</p>';
                return;
            }
            
            teacherBypassCodes.forEach(bypass => {
                const isExpired = Date.now() > bypass.expiry;
                const isUsedUp = bypass.usageCount >= bypass.maxUsage;
                
                let statusText = 'Active';
                let statusClass = 'status-active';
                
                if (isExpired) {
                    statusText = 'Expired';
                    statusClass = 'status-expired';
                } else if (isUsedUp) {
                    statusText = 'Used Up';
                    statusClass = 'status-expired';
                }
                
                const expiryDate = new Date(bypass.expiry).toLocaleString();
                
                const bypassCard = document.createElement('div');
                bypassCard.className = 'bypass-card';
                
                bypassCard.innerHTML = `
                    <div class="bypass-code">${bypass.code}</div>
                    <div class="bypass-info">
                        Created: ${new Date(bypass.created).toLocaleDateString()}<br>
                        Expires: ${expiryDate}<br>
                        Used: ${bypass.usageCount} of ${bypass.maxUsage} times
                    </div>
                    <div>
                        <span class="bypass-status ${statusClass}">${statusText}</span>
                        <button class="btn btn-danger" style="margin-left: 10px; padding: 5px 10px;" onclick="deleteBypassCode('${bypass.code}')">Delete</button>
                    </div>
                `;
                
                bypassList.appendChild(bypassCard);
            });
        }
        
        // Update schedule view
        function updateScheduleView(data) {
            const scheduleList = document.getElementById('scheduleList');
            scheduleList.innerHTML = '';
            
            const teacherSchedules = Object.values(data.schedules || {}).filter(s => 
                s.teacherId === currentUser.id
            );
            
            if (teacherSchedules.length === 0) {
                scheduleList.innerHTML = '<p>No schedules created yet</p>';
                return;
            }
            
            teacherSchedules.forEach(schedule => {
                // Get class info
                const classData = data.classes[schedule.classId];
                const className = classData ? classData.name : 'Unknown Class';
                
                const now = Date.now();
                const startTime = new Date(schedule.date + 'T' + schedule.startTime).getTime();
                const endTime = new Date(schedule.date + 'T' + schedule.endTime).getTime();
                
                let statusText = 'Upcoming';
                let statusClass = 'status-upcoming';
                
                if (now >= startTime && now <= endTime) {
                    statusText = 'Active';
                    statusClass = 'status-active';
                } else if (now > endTime) {
                    statusText = 'Ended';
                    statusClass = 'status-ended';
                }
                
                const scheduleItem = document.createElement('div');
                scheduleItem.className = 'schedule-item';
                
                scheduleItem.innerHTML = `
                    <div class="schedule-details">
                        <div class="schedule-time">${schedule.date} ‚Ä¢ ${schedule.startTime} - ${schedule.endTime}</div>
                        <div class="schedule-class">${className}</div>
                    </div>
                    <div>
                        <span class="schedule-status ${statusClass}">${statusText}</span>
                        <button class="btn btn-danger" style="margin-left: 10px; padding: 5px 10px;" onclick="deleteSchedule('${schedule.id}')">Delete</button>
                    </div>
                `;
                
                scheduleList.appendChild(scheduleItem);
            });
        }
        
        // Update settings view
        function updateSettingsView(data) {
            // Update school code
            document.getElementById('settingsSchoolCode').textContent = currentSchool.code;
            
            // Update user info
            document.getElementById('settingsName').value = currentUser.name;
            document.getElementById('settingsEmail').value = currentUser.email;
        }
        
        // Student control functions
        function lockStudent() {
            if (!selectedStudentId) return;
            
            const data = getSharedData();
            if (!data.studentLocks) data.studentLocks = {};
            data.studentLocks[selectedStudentId] = {
                locked: true,
                timestamp: Date.now(),
                lockedBy: currentUser.name
            };
            
            // Log the action
            if (!data.activityLogs) data.activityLogs = {};
            if (!data.activityLogs[selectedStudentId]) data.activityLogs[selectedStudentId] = [];
            data.activityLogs[selectedStudentId].push({
                action: `Browser locked by ${currentUser.name}`,
                timestamp: Date.now()
            });
            
            saveSharedData(data);
            showSuccess('Student browser locked');
        }
        
        function unlockStudent() {
            if (!selectedStudentId) return;
            
            const data = getSharedData();
            if (data.studentLocks && data.studentLocks[selectedStudentId]) {
                delete data.studentLocks[selectedStudentId];
                
                // Log the action
                if (!data.activityLogs) data.activityLogs = {};
                if (!data.activityLogs[selectedStudentId]) data.activityLogs[selectedStudentId] = [];
                data.activityLogs[selectedStudentId].push({
                    action: `Browser unlocked by ${currentUser.name}`,
                    timestamp: Date.now()
                });
                
                saveSharedData(data);
                showSuccess('Student browser unlocked');
            }
        }
        
        function requestScreenshot() {
            if (!selectedStudentId) return;
            
            const data = getSharedData();
            if (!data.screenshots) data.screenshots = {};
            data.screenshots[selectedStudentId] = {
                requested: true,
                timestamp: Date.now()
            };
            
            saveSharedData(data);
            showSuccess('Screenshot requested from student');
        }
        
        function closeStudentTab(tabIndex = null) {
            if (!selectedStudentId) return;
            
            const data = getSharedData();
            const student = data.students[selectedStudentId];
            
            if (!student || !student.tabs || student.tabs.length === 0) return;
            
            if (tabIndex === null) {
                // Close current tab
                if (student.tabs.length > 1) {
                    student.tabs.splice(student.activeTab, 1);
                    student.activeTab = Math.max(0, student.activeTab - 1);
                }
            } else {
                // Close specific tab
                if (student.tabs.length > 1 && tabIndex >= 0 && tabIndex < student.tabs.length) {
                    student.tabs.splice(tabIndex, 1);
                    if (student.activeTab >= tabIndex) {
                        student.activeTab = Math.max(0, student.activeTab - 1);
                    }
                }
            }
            
            // Send close command to student
            if (!data.teacherControl) data.teacherControl = {};
            data.teacherControl[selectedStudentId] = {
                action: 'closeTab',
                timestamp: Date.now()
            };
            
            saveSharedData(data);
            showSuccess('Tab closed');
        }
        
        function refreshAllScreens() {
            showSuccess('Refreshing all student screens');
            // In a real implementation, this would force all students to send new screenshots
        }
        
        function lockAllBrowsers() {
            const data = getSharedData();
            const teacherClasses = Object.values(data.classes).filter(c => 
                c.teacherId === currentUser.id
            );
            const teacherStudents = Object.values(data.students).filter(s => 
                teacherClasses.some(c => c.id === s.classId)
            );
            
            if (!data.studentLocks) data.studentLocks = {};
            
            teacherStudents.forEach(student => {
                data.studentLocks[student.id] = {
                    locked: true,
                    timestamp: Date.now(),
                    lockedBy: currentUser.name
                };
            });
            
            saveSharedData(data);
            showSuccess(`Locked ${teacherStudents.length} student browsers`);
        }
        
        function showSendMessageModal() {
            if (!selectedStudentId) return;
            document.getElementById('sendMessageModal').style.display = 'flex';
        }
        
        function sendMessageToStudent() {
            if (!selectedStudentId) return;
            
            const messageText = document.getElementById('messageText').value;
            if (!messageText) {
                alert('Please enter a message');
                return;
            }
            
            const data = getSharedData();
            if (!data.messages) data.messages = {};
            if (!data.messages[selectedStudentId]) data.messages[selectedStudentId] = [];
            
            data.messages[selectedStudentId].push({
                text: messageText,
                from: currentUser.name,
                timestamp: Date.now()
            });
            
            // Log the action
            if (!data.activityLogs) data.activityLogs = {};
            if (!data.activityLogs[selectedStudentId]) data.activityLogs[selectedStudentId] = [];
            data.activityLogs[selectedStudentId].push({
                action: `Message sent by ${currentUser.name}: ${messageText}`,
                timestamp: Date.now()
            });
            
            saveSharedData(data);
            
            // Close modal and show success
            closeModal('sendMessageModal');
            showSuccess('Message sent to student');
            
            // Clear form
            document.getElementById('messageText').value = '';
        }
        
        // Class management functions
        function showCreateClassModal() {
            document.getElementById('createClassModal').style.display = 'flex';
        }
        
        function createClass() {
            const name = document.getElementById('className').value;
            const subject = document.getElementById('classSubject').value;
            const grade = document.getElementById('classGrade').value;
            const description = document.getElementById('classDescription').value;
            
            if (!name || !subject || !grade) {
                alert('Please fill in all required fields');
                return;
            }
            
            const data = getSharedData();
            
            // Generate class code
            const classCode = generateClassCode();
            
            // Create class
            data.classes[classCode] = {
                id: classCode,
                name: name,
                teacherId: currentUser.id,
                subject: subject,
                grade: grade,
                description: description,
                schoolId: currentSchool.id,
                code: classCode,
                created: Date.now()
            };
            
            // Save data
            saveSharedData(data);
            
            // Update dashboard
            updateDashboardView();
            
            // Close modal and show success
            closeModal('createClassModal');
            showSuccess('Class created successfully! Code: ' + classCode);
            
            // Clear form
            document.getElementById('className').value = '';
            document.getElementById('classSubject').value = '';
            document.getElementById('classGrade').value = '';
            document.getElementById('classDescription').value = '';
        }
        
        // Bypass code functions
        function showCreateBypassModal() {
            document.getElementById('createBypassModal').style.display = 'flex';
            generateBypassCode();
        }
        
        function generateBypassCode() {
            const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';
            let code = '';
            for (let i = 0; i < 8; i++) {
                code += chars.charAt(Math.floor(Math.random() * chars.length));
            }
            document.getElementById('bypassCode').value = code;
        }
        
        function createBypassCode() {
            const code = document.getElementById('bypassCode').value;
            const expiryMinutes = parseInt(document.getElementById('bypassExpiry').value);
            const maxUsage = parseInt(document.getElementById('bypassUsage').value);
            
            if (!code) {
                alert('Please enter a bypass code');
                return;
            }
            
            const data = getSharedData();
            
            // Create bypass code
            data.bypassCodes[code] = {
                code: code,
                teacherId: currentUser.id,
                created: Date.now(),
                expiry: Date.now() + (expiryMinutes * 60 * 1000),
                maxUsage: maxUsage,
                usageCount: 0
            };
            
            // Save data
            saveSharedData(data);
            
            // Update dashboard
            updateDashboardView();
            
            // Close modal and show success
            closeModal('createBypassModal');
            showSuccess('Bypass code created successfully!');
        }
        
        function deleteBypassCode(code) {
            if (confirm('Are you sure you want to delete this bypass code?')) {
                const data = getSharedData();
                delete data.bypassCodes[code];
                saveSharedData(data);
                updateDashboardView();
            }
        }
        
        // Schedule functions
        function showCreateScheduleModal() {
            // Populate class dropdown
            const scheduleClass = document.getElementById('scheduleClass');
            scheduleClass.innerHTML = '';
            
            const data = getSharedData();
            const teacherClasses = Object.values(data.classes).filter(c => 
                c.teacherId === currentUser.id
            );
            
            teacherClasses.forEach(classItem => {
                const option = document.createElement('option');
                option.value = classItem.id;
                option.textContent = classItem.name;
                scheduleClass.appendChild(option);
            });
            
            // Set default date to today
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('scheduleDate').value = today;
            
            document.getElementById('createScheduleModal').style.display = 'flex';
        }
        
        function createSchedule() {
            const classId = document.getElementById('scheduleClass').value;
            const date = document.getElementById('scheduleDate').value;
            const startTime = document.getElementById('scheduleStartTime').value;
            const endTime = document.getElementById('scheduleEndTime').value;
            const recurring = document.getElementById('scheduleRecurring').value;
            
            if (!classId || !date || !startTime || !endTime) {
                alert('Please fill in all fields');
                return;
            }
            
            const data = getSharedData();
            
            // Create schedule
            const scheduleId = 'schedule_' + Date.now();
            data.schedules[scheduleId] = {
                id: scheduleId,
                classId: classId,
                teacherId: currentUser.id,
                date: date,
                startTime: startTime,
                endTime: endTime,
                recurring: recurring,
                created: Date.now()
            };
            
            // Save data
            saveSharedData(data);
            
            // Update dashboard
            updateDashboardView();
            
            // Close modal and show success
            closeModal('createScheduleModal');
            showSuccess('Schedule created successfully!');
        }
        
        function deleteSchedule(scheduleId) {
            if (confirm('Are you sure you want to delete this schedule?')) {
                const data = getSharedData();
                delete data.schedules[scheduleId];
                saveSharedData(data);
                updateDashboardView();
            }
        }
        
        // Utility functions
        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
        }
        
        function logout() {
            currentUser = null;
            currentSchool = null;
            localStorage.removeItem('currentUser');
            localStorage.removeItem('currentSchool');
            location.reload();
        }
        
        function startMonitoring() {
            updateInterval = setInterval(() => {
                updateDashboardView();
            }, 3000);
        }
        
        function getSharedData() {
            const defaultData = {
                schools: {},
                teachers: {},
                classes: {},
                students: {},
                classSettings: {},
                teacherControl: {},
                messages: {},
                studentLocks: {},
                screenshots: {},
                bypassCodes: {},
                schedules: {},
                activityLogs: {},
                lastUpdated: Date.now()
            };
            
            try {
                const stored = localStorage.getItem('classStacksData');
                if (stored) {
                    const parsed = JSON.parse(stored);
                    return {...defaultData, ...parsed};
                }
            } catch (e) {
                console.error('Error parsing stored data:', e);
            }
            
            return defaultData;
        }
        
        function saveSharedData(data) {
            try {
                data.lastUpdated = Date.now();
                localStorage.setItem('classStacksData', JSON.stringify(data));
                return true;
            } catch (e) {
                console.error('Error saving data:', e);
                return false;
            }
        }
        
        function generateSchoolCode() {
            const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';
            let code = '';
            for (let i = 0; i < 6; i++) {
                code += chars.charAt(Math.floor(Math.random() * chars.length));
            }
            return code;
        }
        
        function generateClassCode() {
            const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';
            let code = '';
            for (let i = 0; i < 8; i++) {
                code += chars.charAt(Math.floor(Math.random() * chars.length));
            }
            return code;
        }
        
        function showError(message) {
            const errorElement = document.getElementById('errorMessage');
            errorElement.textContent = message;
            errorElement.style.display = 'block';
            document.getElementById('successMessage').style.display = 'none';
            setTimeout(() => {
                errorElement.style.display = 'none';
            }, 5000);
        }
        
        function showSuccess(message) {
            const successElement = document.getElementById('successMessage');
            successElement.textContent = message;
            successElement.style.display = 'block';
            document.getElementById('errorMessage').style.display = 'none';
            setTimeout(() => {
                successElement.style.display = 'none';
            }, 5000);
        }
        
        // Initialize the application when the page loads
        document.addEventListener('DOMContentLoaded', initializeApp);
    </script>
</body>
</html>
